# 개요
Document(웹페이지)의 댓글을 표시하는 BottomSheet 컴포넌트.

# Design Pattern
- **Presenter Pattern**: 댓글 데이터 목록을 받아 렌더링하고, 사용자 인터랙션(작성, 확장)을 처리.
- **Event Handling**: 자식(CommentBox)의 이벤트를 받아 상태를 업데이트하거나 상위로 전파.
- **Accordion Pattern**: 댓글을 하나씩 확장/축소.

# Input / Output

## Input
Props {
    doc_comment: list[dict{
        nametag: string,
        content: string,
        commentId: string
    }],
    user_nickname: string,
    epithet: string,
    onSubmitComment: (content: string) => Promise<void>,
    onExpandChange: (commentId: string | null) => void
}

## Output
Output {
    submitComment: (content: string) => Promise<void>,
    expandedCommentId: string | null
}

# Pseudo code
import phosphor-icons
import CommentBox.vue   // 모듈 따로 작성
import color_template.css

// 로컬 상태 관리 (BottomSheet 컴포넌트 내부)
State {
    expandedCommentId: string | null = null
    isWriting: boolean = False
}

Methods {
    handleCommentExpand(commentId: string) {
        if (State.expandedCommentId === commentId) {
            State.expandedCommentId = null  // 같은 것 클릭 시 축소
        } else {
            State.expandedCommentId = commentId  // 다른 것 클릭 시 확장
        }
        Props.onExpandChange(State.expandedCommentId)
    }
    
    handleOutsideClick() {
        State.expandedCommentId = null  // 바깥 클릭 시 모든 확장 해제
        Props.onExpandChange(null)
    }
    
    async handleCommentSubmit(content: string) {
        try {
            await Props.onSubmitComment(content)
            State.isWriting = False
            // 입력 내용 초기화
        } catch (error) {
            console.error("Failed to submit comment:", error)
            // 에러 알림 표시
        }
    }
}

nametag = String(user_nickname, fontColor: color_template.font-black) + String(" • ", fontColor: color_template.grey-lv3) + String(epithet, fontColor: color_template.grey-lv3)
separator = HorizontalGrid(
    Padding(hWidth: 20px),
    HorizontalLine(color: color_template.grey-lv3, width: 4px),
    Padding(hWidth: 20px),
)

dynamic_height = 24 + 64 * len(doc_comment)
comment_box_height = Min([Max([200, dynamic_height])px, `75% of max height`])

comment_box = ScrollableVerticalGrid(
    elements: [
        CommentBox(
            nametag: c.nametag,
            content: c.content,
            commentId: c.commentId,
            isExpanded: State.expandedCommentId === c.commentId,
            onExpand: (id) => handleCommentExpand(id)
        ) for c in Props.doc_comment
    ],
    hPadding: 20px,
    vLength: comment_box_height,
    // ScrollableVerticalGrid 자체는 클릭 이벤트 없음 (CommentBox만 반응)
)

comment_write_box = VerticalGrid(
    elements: [
        ScrollableTextInputBox(
            placeholder: "코멘트를 입력하세요."
        ),
        HorizontalGrid(
            elements: [
                Padding(hWidth: max),
                IconButton(
                    phosphor-icons["Bold"].paper-plane-tilt,
                    onPress: () => handleCommentSubmit(comment_write_box.value)
                )
            ]
        )
    ]
)

VerticalGrid(
    elements: [
        Box(
            fill: gradient(
                start: color_template.background,     //below-side
                end: color_template.grey-lv2,       //upper-side
                rotate: 90deg
            ),
            hWidth: max,
            vLength: 18,
            onPress: () => handleOutsideClick()  // 상단 그라데이션 영역 클릭
        ),
        HorizontalGrid(
            elements:[
                nametag,
                Icon(
                    phosphor-icons["Bold"].pencil-simple-line,
                    color: color_template.grey-lv,
                    onPress: () => isWriting = True
                    )
            ],
            onPress: () => handleOutsideClick()  // 헤더 영역 클릭
        ),
        separator,
        comment_write_box if isWriting else comment_box
    ],
    shadow: Property(   // 위쪽 그림자 방향
        color: color_template.background,
        x-offset: 0px,
        y-offset: -10px
    ),
    onPress: () => handleOutsideClick()  // 전체 컨테이너 클릭 (이벤트 버블링 방지 필요)
)